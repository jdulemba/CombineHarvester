To make exclusion in the [mA,tanb] plane starting from templates_ALL_2017Jul25.root:
1. Do the width extrapolation at 1pc by running:
> python ./Tool/morph_width_extrapolate.py templates_ALL_2017Jul25.root --width 1 --refwidth 2.5 --sgnfactor 2.524551213 --intfactor 1.
#where "width" is the width to extrapolalte, "refwidth" is the width of the signal and background shapes that will be scaled to obtain the shapes at the extrapolated width, "sgnfactor" is the scaling factor for signal shapes, "intfactor" is the scaling factor for interference shapes : new shapes = reference shapes * scale factor

2. Do the width morphing with a binning of 0.5 pc, you may need to run the modified morph_width.py code in Tool/ :
> python ./Tool/modifiedscripts/morph_widths.py templates_ALL_2017Jul25_extrapolated.root
#In the modified code, the option for interpolation is removed: hyperbolic and linear interpolation is automatically assumed for signal and interference shapes respectively; the dictionary "mapping" has the 1pc width included; the dictionary "new_points" are created directly from numpy.arange

3. Apply the K-factor scaling by running:
> python ./Tool/ScaleSgnIntShapes.py templates_ALL_2017Jul25_extrapolated_morphed.root
#Note that the default scaling factors for signal and interference have been taken from the SusHi NNLO and MG LO results
#If you want to specify the K-factors, type:
> python ./Tool/ScaleSgnIntShapes templates_ALL_2017Jul25_extrapolated_morphed.root --sgnfactor 400:2.84E+00,450:2.47E+00,500:2.27E+00,550:2.13E+00,600:2.03E+00,650:1.95E+00,700:1.89E+00,750:1.83E+00 --intfactor 400:2.243323698,450:2.089229843,500:2.002623867,550:1.942805476,600:1.895686751,650:1.856694249,700:1.829439044,750:1.801913174
#The format for specifying the K-factor for a particular mass is MASS:KFACTOR

(optional) If you want to extrapolate the results to higher luminosities, you may scale all the shapes, including signal, interference and background, by running:
> python ./Tool/ScaleAllShapes.py --factor 27.855
#where "factor" specify the scaling factor; for scaling to a luminosity of 1000 pb-1 from 35.9 pb-1, the factor is 1000/35.9 ~ 27.855 
#Alternatively, there is a build-in function in combine that let you scale the shapes when calculating the limits

4. Run the Makefile:
#Remember to include the new widths in the Makefile; you may add --noBBB when running setup_common to exclude bin-by-bin uncertainties
> make cards
> make workspace
> make limits
> make jsons
#In the setup_common code, it may require template files other than the templates_ALL_2017Jul25* file, a slightly modified version I used was included (including a modified version of the Makefile to allow specifying a location for the template files and the limit files). They were located in ./Tool/modifiedscripts/ 

5. Do the exclusion and generate exclusion plots by running:
(cd to ./MakeExclusion)
# Remember to change all the dependencies in the shell script!
# the script plotLimits.py from CombineTools/scripts/ is modified for 1. shading excluded regions; 2. shading extrapolated regions of widths; you may need to use this modified script for running the shell script below
> ./MakeExclusion.sh
# It should do everything for you


To calculate the K-factor:
1. Use the SusHi input from ./SusHi/SusHi_input
2. Refer to README in ./SusHi/scripts and run the scripts to obtain the NNLO cross-sections
3. Use the MG input from ./MG/ggA_sgn or ./MG/ggH_sgn
4. Refer to README in ./MG/scripts and run the scripts to obtain the LO cross-sections

To calculate the cross-section ratio between 2.5pc width and 1pc width for extrapolation:
1. Use the MG input from ./MG/ggA_sgn or ./MG/ggH_sgn for signal cross-section ratio and ./MG/ggA_int or ./MG/ggH_int for interference cross-section ratio
2. To map the corresponding coupling g as MG input from the width in pc, run:
> python ./Tool/MapCouplingFromWidth.py --masses 400,450,500,550,600,650,700,750 --widths 1,2.5 --higgs A
#This will return a txt file containing the corresponding coupling
3. Refer to README in ./MG/scripts and run the scripts to obtain the LO cross-sectoins
4. Rescale the cross-sections by g^4 for signal and g^2 for interference to obtain the cross-section for the data samples (which is generated according to g = 1)

To map mH, sina, sinb,coupling from mA, tanb:
1. Refer to README in ./2HDMC/scripts

To compare two normalized shapes at two different widths:
1. Refer to README in ./ShapeRatio/scripts

To obtain the ratio of peak value of the shapes at two different widths:
1. Refer to README in ./LineShapePeakRatio/scripts

To obtain the combined signal and interference shape for a particular mass and width:
1. Refer to README in ./CombineLineShape/scripts